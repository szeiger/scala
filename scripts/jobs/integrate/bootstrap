#!/bin/bash -e

# See comment in bootstrap_fun

source scripts/common

# scripts/common provides sbtRepositoryConfig
sbtArgs="-ivy $IVY2_DIR -Dsbt.override.build.repos=true -Dsbt.repository.config=$sbtRepositoryConfig"

source scripts/bootstrap_fun

determineScalaVersion
deriveModuleVersions

generateRepositoriesConfig $integrationRepoUrl

removeExistingBuilds $integrationRepoUrl
clearIvyCache

if [ ! -z "$STARR_REF" ]; then
  buildStarr
fi

buildLocker

# locker is now published in BOOTSTRAP_REPO_DIR -- make sure we resolve from there
rm -rf build/

buildModules bootstrap

buildQuick clean testAll publish

testStability

buildModules

if [ "$publishToSonatype" == "yes" ]; then
  publishSonatype
fi
